/* [create-plugin] version: 4.16.0 */
define(["@grafana/data","@grafana/runtime","@grafana/ui","lodash","module","react"],((e,t,n,r,o,i)=>(()=>{var a={499:(e,t)=>{"use strict";t.A=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(","),r=e.name||"",o=(e.type||"").toLowerCase(),i=o.replace(/\/.*$/,"");return n.some((function(e){var t=e.trim().toLowerCase();return"."===t.charAt(0)?r.toLowerCase().endsWith(t):t.endsWith("/*")?i===t.replace(/\/.*$/,""):o===t}))}return!0}},362:(e,t,n)=>{"use strict";var r=n(441);function o(){}function i(){}i.resetWarningCache=o,e.exports=function(){function e(e,t,n,o,i,a){if(a!==r){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:o};return n.PropTypes=n,n}},688:(e,t,n)=>{e.exports=n(362)()},441:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},781:t=>{"use strict";t.exports=e},531:e=>{"use strict";e.exports=t},7:e=>{"use strict";e.exports=n},241:e=>{"use strict";e.exports=r},308:e=>{"use strict";e.exports=o},959:e=>{"use strict";e.exports=i}},l={};function s(e){var t=l[e];if(void 0!==t)return t.exports;var n=l[e]={exports:{}};return a[e](n,n.exports,s),n.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="public/plugins/blackcowmoo-googleanalytics-datasource/";var c={};return(()=>{"use strict";s.r(c),s.d(c,{plugin:()=>ft});var e=s(308),t=s.n(e);s.p=t()&&t().uri?t().uri.slice(0,t().uri.lastIndexOf("/")+1):"public/plugins/blackcowmoo-googleanalytics-datasource/";var n,r,o,i,a=s(781),l=s(7),u=s(959),p=s.n(u);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){m(e,t,n[t])}))}return e}function d(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}!function(e){e.STRING="STRING",e.IN_LIST="IN_LIST"}(n||(n={})),function(e){e[e.NUMBERIC=0]="NUMBERIC",e[e.BETWEEN=1]="BETWEEN"}(r||(r={})),function(e){e.MATCH_TYPE_UNSPECIFIED="MATCH_TYPE_UNSPECIFIED",e.EXACT="EXACT",e.BEGINS_WITH="BEGINS_WITH",e.ENDS_WITH="ENDS_WITH",e.CONTAINS="CONTAINS",e.FULL_REGEXP="FULL_REGEXP",e.PARTIAL_REGEXP="PARTIAL_REGEXP"}(o||(o={})),function(e){e[e.OPERATION_UNSPECIFIED=0]="OPERATION_UNSPECIFIED",e[e.EQUAL=1]="EQUAL",e[e.LESS_THAN=2]="LESS_THAN",e[e.LESS_THAN_OR_EQUAL=3]="LESS_THAN_OR_EQUAL",e[e.GREATER_THAN=4]="GREATER_THAN",e[e.GREATER_THAN_OR_EQUAL=5]="GREATER_THAN_OR_EQUAL"}(i||(i={}));const g=({expression:e={},onChange:t,onDelete:r,selectedDimensions:i})=>{const a=(e,n)=>p().createElement(l.VerticalGroup,null,e.expressions.map(((r,o)=>p().createElement(l.HorizontalGroup,{key:o},p().createElement(g,{expression:r,selectedDimensions:i,onChange:r=>{const i=d(f({},e),{expressions:[...e.expressions]});i.expressions[o]=r,t({[n]:i})},onDelete:()=>{const r=d(f({},e),{expressions:[...e.expressions]});r.expressions.splice(o,1),t({[n]:r})}})))),p().createElement(l.HorizontalGroup,null,p().createElement(l.Button,{onClick:()=>{const r=d(f({},e),{expressions:[...e.expressions,{}]});t({[n]:r})}},"Add Expression"))),s=()=>p().createElement(g,{expression:e.notExpression,selectedDimensions:i,onChange:e=>t({notExpression:e}),onDelete:()=>t({})}),c=()=>{const r=e.filter||{fieldName:"",filterType:n.STRING};return p().createElement(l.VerticalGroup,null,p().createElement(l.Select,{options:i,value:r.fieldName,onChange:e=>t({filter:d(f({},r),{fieldName:e.value})}),placeholder:"Select field"}),p().createElement(l.Select,{options:[{label:"String",value:"STRING"},{label:"List",value:"IN_LIST"}],value:r.filterType,onChange:e=>{let i=d(f({},r),{filterType:e.value});switch(e.value){case n.STRING:i.stringFilter={matchType:o.EXACT,value:"",caseSensitive:!1},i.inListFilter=void 0;break;case n.IN_LIST:i.inListFilter={values:[],caseSensitive:!1},i.stringFilter=void 0}t({filter:i})}}),(()=>{switch(r.filterType){case n.STRING:return u(r.stringFilter);case n.IN_LIST:return m(r.inListFilter);default:return null}})())},u=n=>{const r=Object.values(o).map((e=>({label:e,value:e})));return p().createElement(l.VerticalGroup,null,p().createElement(l.Select,{options:r,value:n.matchType,onChange:r=>t({filter:d(f({},e.filter),{stringFilter:d(f({},n),{matchType:r.value})})})}),p().createElement(l.Input,{value:n.value,onChange:r=>t({filter:d(f({},e.filter),{stringFilter:d(f({},n),{value:r.currentTarget.value})})}),placeholder:"Value"}),p().createElement(l.RadioButtonGroup,{options:[{label:"Case sensitive",value:!0},{label:"Case insensitive",value:!1}],value:n.caseSensitive,onChange:r=>t({filter:d(f({},e.filter),{stringFilter:d(f({},n),{caseSensitive:r})})})}))},m=(n={values:[],caseSensitive:!1})=>p().createElement(l.VerticalGroup,null,p().createElement(l.Input,{value:n.values.join(", "),onChange:r=>t({filter:d(f({},e.filter),{inListFilter:d(f({},n),{values:r.currentTarget.value.split(",").map((e=>e.trim()))})})}),placeholder:"Values (comma-separated)"}),p().createElement(l.RadioButtonGroup,{options:[{label:"Case sensitive",value:!0},{label:"Case insensitive",value:!1}],value:n.caseSensitive,onChange:r=>t({filter:d(f({},e.filter),{inListFilter:d(f({},n),{caseSensitive:r})})})}));return p().createElement(l.FieldSet,null,p().createElement(l.HorizontalGroup,null,p().createElement(l.Select,{options:[{label:"no filter",value:"none"},{label:"AND",value:"andGroup"},{label:"OR",value:"orGroup"},{label:"NOT",value:"notExpression"},{label:"FILTER",value:"filter"}],value:0===Object.keys(e).length?"none":Object.keys(e)[0],onChange:e=>{let r;switch(e.value){case"none":r={};break;case"andGroup":case"orGroup":r={[e.value]:{expressions:[]}};break;case"notExpression":r={notExpression:{}};break;case"filter":r={filter:{fieldName:"",filterType:n.STRING,stringFilter:{matchType:o.EXACT,value:"",caseSensitive:!1}}};break;default:return}t(r)}}),0===Object.keys(e).length?p().createElement("div",null,"No filter set"):e.andGroup?a(e.andGroup,"andGroup"):e.orGroup?a(e.orGroup,"orGroup"):e.notExpression?s():e.filter?c():null,r&&p().createElement(l.Button,{variant:"destructive",onClick:r},"Delete")))};var y=s(241),v=s.n(y);function h(e,t,n,r,o,i,a){try{var l=e[i](a),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){b(e,t,n[t])}))}return e}function O(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const w={text:"GA4(alpha)",tootip:"experimental support"},D=[{label:"Time Series",value:"time series"},{label:"Table",value:"table"},{label:"Realtime",value:"realtime"}],P={text:"Standard",tootip:"max realtime query 30min"},S={text:"Premium",tootip:"max realtime query 60min"},j="GOOGLE_ANALYTICS_STANDARD",x="GOOGLE_ANALYTICS_360";class C extends u.PureComponent{render(){const{query:e,datasource:t}=this.props,{accountId:n,webPropertyId:r,selectedTimeDimensions:o,selectedMetrics:i,selectedDimensions:a,timezone:s,mode:c,serviceLevel:u}=e,m=null==r?void 0:r.split("/")[1];let f;switch(u){case x:f=p().createElement(l.Badge,{color:"orange",text:S.text,tooltip:S.tootip,icon:"google"});break;case j:f=p().createElement(l.Badge,{color:"orange",text:P.text,tooltip:P.tootip,icon:"google"});break;default:f=p().createElement(l.Badge,{color:"orange",text:"Unknown",tooltip:"Unknown",icon:"google"})}return p().createElement(p().Fragment,null,p().createElement("div",{className:"gf-form-group"},p().createElement("div",{className:"gf-form"},p().createElement(l.HorizontalGroup,{spacing:"sm",justify:"flex-start"},p().createElement(l.ButtonCascader,{options:this.options,onChange:this.onIdSelect},"Account Select"),p().createElement(l.InlineLabel,{"aria-label":"account-info"},`Account: ${n||""},Property: ${r||""}`),p().createElement(l.InlineLabel,{className:"query-keyword",width:"auto",tooltip:p().createElement(p().Fragment,null,"GA timeZone")},"Timezone"),p().createElement(l.InlineLabel,{width:"auto"},s||"determined by profileId"),p().createElement(l.Badge,{color:"orange",text:w.text,tooltip:w.tootip,icon:"google"}),f)),p().createElement("div",{className:"gf-form"},p().createElement(l.InlineFormLabel,{className:"query-keyword",tooltip:p().createElement(p().Fragment,null,"The ",p().createElement("code",null,"metric")," ga:*")},"Metrics"),p().createElement(l.AsyncMultiSelect,{loadOptions:e=>"realtime"===c?t.getRealtimeMetrics(e,m):t.getMetrics(e,m),placeholder:"ga:sessions",value:i,onChange:this.onMetricChange,backspaceRemovesValue:!0,noOptionsMessage:"Search Metrics",defaultOptions:!0,menuPlacement:"bottom",isClearable:!0,key:c+r+"metrics","aria-label":"metrics"}),p().createElement(l.InlineFormLabel,{className:"query-keyword",tooltip:p().createElement(p().Fragment,null,"The ",p().createElement("code",null,"time dimensions")," At least one ga:date* is required.")},"Time Dimension"),p().createElement(l.AsyncSelect,{loadOptions:()=>t.getTimeDimensions(),placeholder:"ga:dateHour",value:o,onChange:this.onTimeDimensionChange,backspaceRemovesValue:!0,noOptionsMessage:"Search Dimension",defaultOptions:!0,menuPlacement:"bottom",isClearable:!0,disabled:"realtime"===c,"aria-label":"time-dimension"}),p().createElement(l.InlineFormLabel,{className:"query-keyword",tooltip:p().createElement(p().Fragment,null,"The ",p().createElement("code",null,"dimensions")," exclude time dimensions")},"Dimensions"),p().createElement(l.AsyncMultiSelect,{loadOptions:e=>"realtime"===c?t.getRealtimeDimensions(e,null,m):t.getDimensionsExcludeTimeDimensions(e,m),placeholder:"ga:country",value:a,onChange:this.onDimensionChange,backspaceRemovesValue:!0,noOptionsMessage:"Search Dimension",defaultOptions:!0,menuPlacement:"bottom",isClearable:!0,key:c+m+"dimensions","aria-label":"dimensions"})),p().createElement("div",{className:"gf-form"},p().createElement(l.InlineFormLabel,{className:"query-keyword",tooltip:p().createElement(p().Fragment,null,"Currently, only ",p().createElement("code",null,"or groups")," are supported.")},"DimensionFilter"),p().createElement(g,{expression:e.dimensionFilter,onChange:this.onFiltersExpressionChange,selectedDimensions:a,onDelete:void 0})),p().createElement("div",{className:"gf-form"},p().createElement(l.InlineFormLabel,{className:"query-keyword"},"Query Mode"),p().createElement(l.RadioButtonGroup,{options:D,onChange:this.onModeChange,value:c,"aria-label":"query-mode"}))))}constructor(e){super(e),b(this,"options",[]),b(this,"onMetricChange",(e=>{const{query:t,onChange:n}=this.props;let r=[];e.map((e=>{e.value&&r.push(e.value)})),n(O(E({},t),{selectedMetrics:e,metrics:r})),this.willRunQuery()})),b(this,"onTimeDimensionChange",(e=>{const{query:t,onChange:n}=this.props;let r=(null==e?void 0:e.value)||"";n(O(E({},t),{timeDimension:r,selectedTimeDimensions:e})),this.willRunQuery()}));var t,n,r=this;b(this,"onIdSelect",(t=function*(e,t){const[n,o,i]=e,{query:a,onChange:l,datasource:s}=r.props,c=yield s.getTimezone(n,o,i),u=yield s.getServiceLevel(n,o);l(O(E({},a),{accountId:n,webPropertyId:o,profileId:i,timezone:c,serviceLevel:u})),r.willRunQuery()},n=function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(e){h(i,r,o,a,l,"next",e)}function l(e){h(i,r,o,a,l,"throw",e)}a(void 0)}))},function(e,t){return n.apply(this,arguments)})),b(this,"onDimensionChange",(e=>{const{query:t,onChange:n}=this.props;let r=[];e.map((e=>{e.value&&r.push(e.value)})),n(O(E({},t),{selectedDimensions:e,dimensions:r})),this.willRunQuery()})),b(this,"onFiltersExpressionChange",(e=>{const{query:t,onChange:n}=this.props;n(O(E({},t),{dimensionFilter:e})),this.willRunQuery()})),b(this,"onModeChange",(e=>{const{query:t,onChange:n}=this.props;if("realtime"===e)t.timeDimension="",t.selectedTimeDimensions={};n(O(E({},t),{mode:e})),this.willRunQuery()})),b(this,"willRunQuery",v().debounce((()=>{const{query:e,onRunQuery:t}=this.props,{webPropertyId:n,metrics:r,timeDimension:o,mode:i}=e;n&&r&&("table"===i||"realtime"===i||o)&&t()}),500)),b(this,"setDisplayName",((e,t="")=>{const{query:{displayName:n}}=this.props;n.set(e,t)})),b(this,"getDisplayName",(e=>{const{query:{displayName:t}}=this.props;return t.has(e)?t.get(e):""}));const{query:o}=this.props;o.hasOwnProperty("cacheDurationSeconds")||(this.props.query.cacheDurationSeconds=300),this.props.query.version=e.datasource.getGaVersion(),this.props.query.displayName=new Map,this.props.datasource.getAccountSummaries().then((e=>{this.options=e,this.props.onChange(this.props.query)})),void 0!==o.mode&&""!==o.mode||(o.mode="time series"),void 0===o.dimensionFilter&&(o.dimensionFilter={})}}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){A(e,t,n[t])}))}return e}function I(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const F={text:"UA",tootip:"2023/07/01 no more data collect"},k={text:"GA4(alpha)",tootip:"experimental support"};class R extends u.PureComponent{render(){const{query:e,datasource:t}=this.props,{accountId:n,webPropertyId:r,profileId:o,selectedTimeDimensions:i,selectedMetrics:a,selectedDimensions:s,timezone:c,filtersExpression:u,version:m}=e,f=null==r?void 0:r.split("/")[1];return p().createElement(p().Fragment,null,p().createElement("div",{className:"gf-form-group"},p().createElement("div",{className:"gf-form"},p().createElement(l.HorizontalGroup,{spacing:"sm",justify:"flex-start"},p().createElement(l.ButtonCascader,{options:this.options,onChange:this.onIdSelect}),p().createElement(l.InlineLabel,null,`Account: ${n||""},Property: ${r||""},Profile ${o||""}`),p().createElement(l.InlineLabel,{className:"query-keyword",width:"auto",tooltip:p().createElement(p().Fragment,null,"GA timeZone")},"Timezone"),p().createElement(l.InlineLabel,{width:"auto"},c||"determined by profileId"),"v3"===m&&p().createElement(l.Badge,{color:"red",text:F.text,tooltip:F.tootip,icon:"google"}),"v4"===m&&p().createElement(l.Badge,{color:"orange",text:k.text,tooltip:k.tootip,icon:"google"}))),p().createElement("div",{className:"gf-form",key:f},p().createElement(l.InlineFormLabel,{className:"query-keyword",tooltip:p().createElement(p().Fragment,null,"The ",p().createElement("code",null,"metric")," ga:*")},"Metrics"),p().createElement(l.AsyncMultiSelect,{loadOptions:e=>t.getMetrics(e,f),placeholder:"ga:sessions",value:a,onChange:this.onMetricChange,backspaceRemovesValue:!0,cacheOptions:!0,noOptionsMessage:"Search Metrics",defaultOptions:!0,menuPlacement:"bottom",isClearable:!0}),p().createElement(l.InlineFormLabel,{className:"query-keyword",tooltip:p().createElement(p().Fragment,null,"The ",p().createElement("code",null,"time dimensions")," At least one ga:date* is required.")},"Time Dimension"),p().createElement(l.AsyncSelect,{loadOptions:()=>t.getTimeDimensions(),placeholder:"ga:dateHour",value:i,onChange:this.onTimeDimensionChange,backspaceRemovesValue:!0,cacheOptions:!0,noOptionsMessage:"Search Dimension",defaultOptions:!0,menuPlacement:"bottom",isClearable:!0}),p().createElement(l.InlineFormLabel,{className:"query-keyword",tooltip:p().createElement(p().Fragment,null,"The ",p().createElement("code",null,"dimensions")," exclude time dimensions")},"Dimensions"),p().createElement(l.AsyncMultiSelect,{loadOptions:e=>t.getDimensionsExcludeTimeDimensions(e,f),placeholder:"ga:country",value:s,onChange:this.onDimensionChange,backspaceRemovesValue:!0,cacheOptions:!0,noOptionsMessage:"Search Dimension",defaultOptions:!0,menuPlacement:"bottom",isClearable:!0})),p().createElement("div",{className:"gf-form"},p().createElement(l.InlineFormLabel,{className:"query-keyword",tooltip:p().createElement(p().Fragment,null,"The ",p().createElement("code",null,"filter")," dimensions and metrics")},"Filters Expressions"),p().createElement(l.Input,{value:u,onChange:e=>this.onFiltersExpressionChange(e.currentTarget.value),placeholder:"ga:pagePath==/path/to/page"}))))}constructor(e){super(e),A(this,"options",[]),A(this,"onMetricChange",(e=>{const{query:t,onChange:n}=this.props;let r=[];e.map((e=>{e.value&&r.push(e.value)})),n(I(T({},t),{selectedMetrics:e,metrics:r})),this.willRunQuery()})),A(this,"onTimeDimensionChange",(e=>{const{query:t,onChange:n}=this.props;let r=e.value;n(I(T({},t),{timeDimension:r,selectedTimeDimensions:e})),this.willRunQuery()})),A(this,"onIdSelect",((e,t)=>{const[n,r,o]=e,{query:i,onChange:a,datasource:l}=this.props;l.getTimezone(n,r,o).then((e=>{const{query:t,onChange:n}=this.props;n(I(T({},t),{timezone:e})),this.willRunQuery()})),a(I(T({},i),{accountId:n,webPropertyId:r,profileId:o})),this.willRunQuery()})),A(this,"onDimensionChange",(e=>{const{query:t,onChange:n}=this.props;let r=[];e.map((e=>{e.value&&r.push(e.value)})),n(I(T({},t),{selectedDimensions:e,dimensions:r})),this.willRunQuery()})),A(this,"onFiltersExpressionChange",((e,...t)=>{const{query:n,onChange:r}=this.props;let{filtersExpression:o}=n;o=e,r(I(T({},n),{filtersExpression:o})),this.willRunQuery()})),A(this,"willRunQuery",v().debounce((()=>{const{query:e,onRunQuery:t}=this.props,{version:n,webPropertyId:r,profileId:o,metrics:i,timeDimension:a}=e;(o&&i&&a&&"v3"===n||r&&i&&a&&"v4"===n)&&t()}),500)),A(this,"setDisplayName",((e,t="")=>{const{query:{displayName:n}}=this.props;n.set(e,t)})),A(this,"getDisplayName",(e=>{const{query:{displayName:t}}=this.props;return t.has(e)?t.get(e):""})),this.props.query.hasOwnProperty("cacheDurationSeconds")||(this.props.query.cacheDurationSeconds=300,this.props.query.filtersExpression=""),this.props.query.version=e.datasource.getGaVersion(),this.props.query.displayName=new Map,this.props.datasource.getAccountSummaries().then((e=>{this.options=e,this.props.onChange(this.props.query)}))}}class N extends u.PureComponent{render(){const{query:e,datasource:t,onChange:n,onRunQuery:r}=this.props,{version:o}=e;return"v4"===o?p().createElement(C,{datasource:t,onChange:n,onRunQuery:r,query:e}):p().createElement(R,{datasource:t,onChange:n,onRunQuery:r,query:e})}constructor(e){super(e),this.props.query.version=e.datasource.getGaVersion()}}var L=s(688),_=s.n(L);function G(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function l(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))}function M(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}}Object.create;function q(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function z(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}Object.create;"function"==typeof SuppressedError&&SuppressedError;var B=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function U(e,t){var n=function(e){var t=e.name;if(t&&-1!==t.lastIndexOf(".")&&!e.type){var n=t.split(".").pop().toLowerCase(),r=B.get(n);r&&Object.defineProperty(e,"type",{value:r,writable:!1,configurable:!1,enumerable:!0})}return e}(e);if("string"!=typeof n.path){var r=e.webkitRelativePath;Object.defineProperty(n,"path",{value:"string"==typeof t?t:"string"==typeof r&&r.length>0?r:e.name,writable:!1,configurable:!1,enumerable:!0})}return n}var Q=[".DS_Store","Thumbs.db"];function H(e){return"object"==typeof e&&null!==e}function W(e){return $(e.target.files).map((function(e){return U(e)}))}function V(e){return G(this,void 0,void 0,(function(){return M(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return e.getFile()})))];case 1:return[2,t.sent().map((function(e){return U(e)}))]}}))}))}function J(e,t){return G(this,void 0,void 0,(function(){var n;return M(this,(function(r){switch(r.label){case 0:return e.items?(n=$(e.items).filter((function(e){return"file"===e.kind})),"drop"!==t?[2,n]:[4,Promise.all(n.map(X))]):[3,2];case 1:return[2,K(Y(r.sent()))];case 2:return[2,K($(e.files).map((function(e){return U(e)})))]}}))}))}function K(e){return e.filter((function(e){return-1===Q.indexOf(e.name)}))}function $(e){if(null===e)return[];for(var t=[],n=0;n<e.length;n++){var r=e[n];t.push(r)}return t}function X(e){if("function"!=typeof e.webkitGetAsEntry)return Z(e);var t=e.webkitGetAsEntry();return t&&t.isDirectory?te(t):Z(e)}function Y(e){return e.reduce((function(e,t){return z(z([],q(e),!1),q(Array.isArray(t)?Y(t):[t]),!1)}),[])}function Z(e){var t=e.getAsFile();if(!t)return Promise.reject("".concat(e," is not a File"));var n=U(t);return Promise.resolve(n)}function ee(e){return G(this,void 0,void 0,(function(){return M(this,(function(t){return[2,e.isDirectory?te(e):ne(e)]}))}))}function te(e){var t=e.createReader();return new Promise((function(e,n){var r=[];!function o(){var i=this;t.readEntries((function(t){return G(i,void 0,void 0,(function(){var i,a,l;return M(this,(function(s){switch(s.label){case 0:if(t.length)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Promise.all(r)];case 2:return i=s.sent(),e(i),[3,4];case 3:return a=s.sent(),n(a),[3,4];case 4:return[3,6];case 5:l=Promise.all(t.map(ee)),r.push(l),o(),s.label=6;case 6:return[2]}}))}))}),(function(e){n(e)}))}()}))}function ne(e){return G(this,void 0,void 0,(function(){return M(this,(function(t){return[2,new Promise((function(t,n){e.file((function(n){var r=U(n,e.fullPath);t(r)}),(function(e){n(e)}))}))]}))}))}var re=s(499);function oe(e){return function(e){if(Array.isArray(e))return ue(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ce(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach((function(t){le(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function se(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}(e,t)||ce(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(e,t){if(e){if("string"==typeof e)return ue(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ue(e,t):void 0}}function ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var pe="file-invalid-type",me="file-too-large",fe="file-too-small",de="too-many-files",ge=function(e){e=Array.isArray(e)&&1===e.length?e[0]:e;var t=Array.isArray(e)?"one of ".concat(e.join(", ")):e;return{code:pe,message:"File type must be ".concat(t)}},ye=function(e){return{code:me,message:"File is larger than ".concat(e," ").concat(1===e?"byte":"bytes")}},ve=function(e){return{code:fe,message:"File is smaller than ".concat(e," ").concat(1===e?"byte":"bytes")}},he={code:de,message:"Too many files"};function be(e,t){var n="application/x-moz-file"===e.type||(0,re.A)(e,t);return[n,n?null:ge(t)]}function Ee(e,t,n){if(Oe(e.size))if(Oe(t)&&Oe(n)){if(e.size>n)return[!1,ye(n)];if(e.size<t)return[!1,ve(t)]}else{if(Oe(t)&&e.size<t)return[!1,ve(t)];if(Oe(n)&&e.size>n)return[!1,ye(n)]}return[!0,null]}function Oe(e){return null!=e}function we(e){return"function"==typeof e.isPropagationStopped?e.isPropagationStopped():void 0!==e.cancelBubble&&e.cancelBubble}function De(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,(function(e){return"Files"===e||"application/x-moz-file"===e})):!!e.target&&!!e.target.files}function Pe(e){e.preventDefault()}function Se(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return t.some((function(t){return!we(e)&&t&&t.apply(void 0,[e].concat(r)),we(e)}))}}function je(e){return"audio/*"===e||"video/*"===e||"image/*"===e||"text/*"===e||/\w+\/[-+.\w]+/g.test(e)}function xe(e){return/^.*\.[\w]+$/.test(e)}var Ce=["children"],Ae=["open"],Te=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Ie=["refKey","onChange","onClick"];function Fe(e){return function(e){if(Array.isArray(e))return Ne(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Re(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ke(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}(e,t)||Re(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Re(e,t){if(e){if("string"==typeof e)return Ne(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ne(e,t):void 0}}function Ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach((function(t){Ge(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Me(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var qe=(0,u.forwardRef)((function(e,t){var n=e.children,r=Ue(Me(e,Ce)),o=r.open,i=Me(r,Ae);return(0,u.useImperativeHandle)(t,(function(){return{open:o}}),[o]),p().createElement(u.Fragment,null,n(_e(_e({},i),{},{open:o})))}));qe.displayName="Dropzone";var ze={disabled:!1,getFilesFromEvent:function(e){return G(this,void 0,void 0,(function(){return M(this,(function(t){return H(e)&&H(e.dataTransfer)?[2,J(e.dataTransfer,e.type)]:function(e){return H(e)&&H(e.target)}(e)?[2,W(e)]:Array.isArray(e)&&e.every((function(e){return"getFile"in e&&"function"==typeof e.getFile}))?[2,V(e)]:[2,[]]}))}))},maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0,autoFocus:!1};qe.defaultProps=ze,qe.propTypes={children:_().func,accept:_().objectOf(_().arrayOf(_().string)),multiple:_().bool,preventDropOnDocument:_().bool,noClick:_().bool,noKeyboard:_().bool,noDrag:_().bool,noDragEventsBubbling:_().bool,minSize:_().number,maxSize:_().number,maxFiles:_().number,disabled:_().bool,getFilesFromEvent:_().func,onFileDialogCancel:_().func,onFileDialogOpen:_().func,useFsAccessApi:_().bool,autoFocus:_().bool,onDragEnter:_().func,onDragLeave:_().func,onDragOver:_().func,onDrop:_().func,onDropAccepted:_().func,onDropRejected:_().func,onError:_().func,validator:_().func};var Be={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Ue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=_e(_e({},ze),e),n=t.accept,r=t.disabled,o=t.getFilesFromEvent,i=t.maxSize,a=t.minSize,l=t.multiple,s=t.maxFiles,c=t.onDragEnter,p=t.onDragLeave,m=t.onDragOver,f=t.onDrop,d=t.onDropAccepted,g=t.onDropRejected,y=t.onFileDialogCancel,v=t.onFileDialogOpen,h=t.useFsAccessApi,b=t.autoFocus,E=t.preventDropOnDocument,O=t.noClick,w=t.noKeyboard,D=t.noDrag,P=t.noDragEventsBubbling,S=t.onError,j=t.validator,x=(0,u.useMemo)((function(){return function(e){if(Oe(e))return Object.entries(e).reduce((function(e,t){var n=se(t,2),r=n[0],o=n[1];return[].concat(oe(e),[r],oe(o))}),[]).filter((function(e){return je(e)||xe(e)})).join(",")}(n)}),[n]),C=(0,u.useMemo)((function(){return function(e){return Oe(e)?[{description:"Files",accept:Object.entries(e).filter((function(e){var t=se(e,2),n=t[0],r=t[1],o=!0;return je(n)||(console.warn('Skipped "'.concat(n,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),o=!1),Array.isArray(r)&&r.every(xe)||(console.warn('Skipped "'.concat(n,'" because an invalid file extension was provided.')),o=!1),o})).reduce((function(e,t){var n=se(t,2),r=n[0],o=n[1];return ae(ae({},e),{},le({},r,o))}),{})}]:e}(n)}),[n]),A=(0,u.useMemo)((function(){return"function"==typeof v?v:He}),[v]),T=(0,u.useMemo)((function(){return"function"==typeof y?y:He}),[y]),I=(0,u.useRef)(null),F=(0,u.useRef)(null),k=ke((0,u.useReducer)(Qe,Be),2),R=k[0],N=k[1],L=R.isFocused,_=R.isFileDialogActive,G=(0,u.useRef)("undefined"!=typeof window&&window.isSecureContext&&h&&"showOpenFilePicker"in window),M=function(){!G.current&&_&&setTimeout((function(){F.current&&(F.current.files.length||(N({type:"closeDialog"}),T()))}),300)};(0,u.useEffect)((function(){return window.addEventListener("focus",M,!1),function(){window.removeEventListener("focus",M,!1)}}),[F,_,T,G]);var q=(0,u.useRef)([]),z=function(e){I.current&&I.current.contains(e.target)||(e.preventDefault(),q.current=[])};(0,u.useEffect)((function(){return E&&(document.addEventListener("dragover",Pe,!1),document.addEventListener("drop",z,!1)),function(){E&&(document.removeEventListener("dragover",Pe),document.removeEventListener("drop",z))}}),[I,E]),(0,u.useEffect)((function(){return!r&&b&&I.current&&I.current.focus(),function(){}}),[I,b,r]);var B=(0,u.useCallback)((function(e){S?S(e):console.error(e)}),[S]),U=(0,u.useCallback)((function(e){e.preventDefault(),e.persist(),ne(e),q.current=[].concat(Fe(q.current),[e.target]),De(e)&&Promise.resolve(o(e)).then((function(t){if(!we(e)||P){var n=t.length,r=n>0&&function(e){var t=e.files,n=e.accept,r=e.minSize,o=e.maxSize,i=e.multiple,a=e.maxFiles,l=e.validator;return!(!i&&t.length>1||i&&a>=1&&t.length>a)&&t.every((function(e){var t=se(be(e,n),1)[0],i=se(Ee(e,r,o),1)[0],a=l?l(e):null;return t&&i&&!a}))}({files:t,accept:x,minSize:a,maxSize:i,multiple:l,maxFiles:s,validator:j});N({isDragAccept:r,isDragReject:n>0&&!r,isDragActive:!0,type:"setDraggedFiles"}),c&&c(e)}})).catch((function(e){return B(e)}))}),[o,c,B,P,x,a,i,l,s,j]),Q=(0,u.useCallback)((function(e){e.preventDefault(),e.persist(),ne(e);var t=De(e);if(t&&e.dataTransfer)try{e.dataTransfer.dropEffect="copy"}catch(e){}return t&&m&&m(e),!1}),[m,P]),H=(0,u.useCallback)((function(e){e.preventDefault(),e.persist(),ne(e);var t=q.current.filter((function(e){return I.current&&I.current.contains(e)})),n=t.indexOf(e.target);-1!==n&&t.splice(n,1),q.current=t,t.length>0||(N({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),De(e)&&p&&p(e))}),[I,p,P]),W=(0,u.useCallback)((function(e,t){var n=[],r=[];e.forEach((function(e){var t=ke(be(e,x),2),o=t[0],l=t[1],s=ke(Ee(e,a,i),2),c=s[0],u=s[1],p=j?j(e):null;if(o&&c&&!p)n.push(e);else{var m=[l,u];p&&(m=m.concat(p)),r.push({file:e,errors:m.filter((function(e){return e}))})}})),(!l&&n.length>1||l&&s>=1&&n.length>s)&&(n.forEach((function(e){r.push({file:e,errors:[he]})})),n.splice(0)),N({acceptedFiles:n,fileRejections:r,type:"setFiles"}),f&&f(n,r,t),r.length>0&&g&&g(r,t),n.length>0&&d&&d(n,t)}),[N,l,x,a,i,s,f,d,g,j]),V=(0,u.useCallback)((function(e){e.preventDefault(),e.persist(),ne(e),q.current=[],De(e)&&Promise.resolve(o(e)).then((function(t){we(e)&&!P||W(t,e)})).catch((function(e){return B(e)})),N({type:"reset"})}),[o,W,B,P]),J=(0,u.useCallback)((function(){if(G.current){N({type:"openDialog"}),A();var e={multiple:l,types:C};window.showOpenFilePicker(e).then((function(e){return o(e)})).then((function(e){W(e,null),N({type:"closeDialog"})})).catch((function(e){var t;(t=e)instanceof DOMException&&("AbortError"===t.name||t.code===t.ABORT_ERR)?(T(e),N({type:"closeDialog"})):!function(e){return e instanceof DOMException&&("SecurityError"===e.name||e.code===e.SECURITY_ERR)}(e)?B(e):(G.current=!1,F.current?(F.current.value=null,F.current.click()):B(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided.")))}))}else F.current&&(N({type:"openDialog"}),A(),F.current.value=null,F.current.click())}),[N,A,T,h,W,B,C,l]),K=(0,u.useCallback)((function(e){I.current&&I.current.isEqualNode(e.target)&&(" "!==e.key&&"Enter"!==e.key&&32!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),J()))}),[I,J]),$=(0,u.useCallback)((function(){N({type:"focus"})}),[]),X=(0,u.useCallback)((function(){N({type:"blur"})}),[]),Y=(0,u.useCallback)((function(){O||(!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.navigator.userAgent;return function(e){return-1!==e.indexOf("MSIE")||-1!==e.indexOf("Trident/")}(e)||function(e){return-1!==e.indexOf("Edge/")}(e)}()?J():setTimeout(J,0))}),[O,J]),Z=function(e){return r?null:e},ee=function(e){return w?null:Z(e)},te=function(e){return D?null:Z(e)},ne=function(e){P&&e.stopPropagation()},re=(0,u.useMemo)((function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.refKey,n=void 0===t?"ref":t,o=e.role,i=e.onKeyDown,a=e.onFocus,l=e.onBlur,s=e.onClick,c=e.onDragEnter,u=e.onDragOver,p=e.onDragLeave,m=e.onDrop,f=Me(e,Te);return _e(_e(Ge({onKeyDown:ee(Se(i,K)),onFocus:ee(Se(a,$)),onBlur:ee(Se(l,X)),onClick:Z(Se(s,Y)),onDragEnter:te(Se(c,U)),onDragOver:te(Se(u,Q)),onDragLeave:te(Se(p,H)),onDrop:te(Se(m,V)),role:"string"==typeof o&&""!==o?o:"presentation"},n,I),r||w?{}:{tabIndex:0}),f)}}),[I,K,$,X,Y,U,Q,H,V,w,D,r]),ie=(0,u.useCallback)((function(e){e.stopPropagation()}),[]),ce=(0,u.useMemo)((function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.refKey,n=void 0===t?"ref":t,r=e.onChange,o=e.onClick,i=Me(e,Ie);return _e(_e({},Ge({accept:x,multiple:l,type:"file",style:{display:"none"},onChange:Z(Se(r,V)),onClick:Z(Se(o,ie)),tabIndex:-1},n,F)),i)}}),[F,n,l,V,r]);return _e(_e({},R),{},{isFocused:L&&!r,getRootProps:re,getInputProps:ce,rootRef:I,inputRef:F,open:Z(J)})}function Qe(e,t){switch(t.type){case"focus":return _e(_e({},e),{},{isFocused:!0});case"blur":return _e(_e({},e),{},{isFocused:!1});case"openDialog":return _e(_e({},Be),{},{isFileDialogActive:!0});case"closeDialog":return _e(_e({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":return _e(_e({},e),{},{isDragActive:t.isDragActive,isDragAccept:t.isDragAccept,isDragReject:t.isDragReject});case"setFiles":return _e(_e({},e),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections});case"reset":return _e({},Be);default:return e}}function He(){}function We(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){We(e,t,n[t])}))}return e}function Je(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const Ke={display:"flex",justifyContent:"center",alignItems:"center",height:"150px",backgroundColor:"#212327",padding:24,borderWidth:2,borderRadius:2,borderColor:"#808080",borderStyle:"dashed",outline:"none",transition:"border .24s ease-in-out"},$e={borderColor:"#2196f3"},Xe={borderColor:"#EF843C"},Ye={borderColor:"#E24D42"};function Ze(e){var{children:t,baseStyle:n={},activeStyle:r={},acceptStyle:o={},rejectStyle:i={}}=e,a=Je(e,["children","baseStyle","activeStyle","acceptStyle","rejectStyle"]);const{getRootProps:l,getInputProps:s,isDragActive:c,isDragAccept:m,isDragReject:f}=Ue(a),d=(0,u.useMemo)((()=>Ve({},Ke,n,c?Ve({},$e,r):{},m?Ve({},Xe,o):{},f?Ve({},Ye,i):{})),[c,m,f,r,o,i,n]);return p().createElement("div",l({style:d}),p().createElement("input",s()),t)}const et=["type","project_id","private_key_id","private_key","client_email","client_id","auth_uri","token_uri","auth_provider_x509_cert_url","client_x509_cert_url"];function tt({onChange:e,isConfigured:t}){const[n,r]=(0,u.useState)(!t),[o,i]=(0,u.useState)();return n?p().createElement(p().Fragment,null,p().createElement(Ze,{baseStyle:{marginTop:"24px"},accept:{json:["application/json","json"]},onDrop:t=>{const n=new FileReader;1===t.length?(n.onloadend=t=>{(e=>(0,y.isObject)(e)&&et.every((t=>!!e[t])))(JSON.parse(t.target.result))?(e(t.target.result),r(!1)):i("Invalid JWT file")},n.readAsText(t[0])):t.length>1&&i("You can only upload one file")}},p().createElement("p",{style:{margin:0,fontSize:18}},"Drop the file here, or click to use the file explorer")),o&&p().createElement(l.Alert,{severity:"error",title:o})):p().createElement(p().Fragment,null,et.map((e=>p().createElement("div",{className:"gf-form",key:e},p().createElement(l.InlineFormLabel,{width:10},(0,y.startCase)(e)),p().createElement("input",{disabled:!0,className:"gf-form-input width-30",value:"configured"})))),p().createElement(l.Button,{style:{marginTop:12},variant:"secondary",onClick:()=>r(!0)},"Upload another JWT file"))}function nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){nt(e,t,n[t])}))}return e}function ot(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const it=[{label:"UA(GA3)",value:"v3"},{label:"GA4(beta)",value:"v4"}];class at extends u.PureComponent{render(){const{options:e,onOptionsChange:t}=this.props,{secureJsonFields:n}=e,r=e.secureJsonData,o=e.jsonData;return p().createElement("div",{className:"gf-form-group"},p().createElement(l.RadioButtonGroup,{options:it,onChange:n=>t(ot(rt({},e),{jsonData:ot(rt({},o),{version:n})})),value:e.jsonData.version}),p().createElement(p().Fragment,null,p().createElement(tt,{isConfigured:n&&!!n.jwt,onChange:n=>{t(ot(rt({},e),{secureJsonData:ot(rt({},r),{jwt:n})}))}})),p().createElement(l.Alert,{title:"Generate a JWT file",severity:"info"},p().createElement("ol",{style:{listStylePosition:"inside"}},p().createElement("li",null,"if you don't have gcp project, add new gcp project.",p().createElement("a",{href:"https://cloud.google.com/resource-manager/docs/creating-managing-projects#console"},"link")),p().createElement("li",null,"Open the ",p().createElement("a",{href:"https://console.developers.google.com/apis/credentials"},"Credentials")," page in the Google API Console."),p().createElement("li",null,"Click ",p().createElement("strong",null,"Create Credentials")," then click ",p().createElement("strong",null,"Service account"),"."),p().createElement("li",null,"On the Create service account page, enter the Service account details."),p().createElement("li",null,"On the ",p().createElement("code",null,"Create service account")," page, fill in the ",p().createElement("code",null,"Service account details")," and then click ",p().createElement("code",null,"Create")),p().createElement("li",null,"On the ",p().createElement("code",null,"Service account permissions")," page, don't add a role to the service account. Just click ",p().createElement("code",null,"Continue")),p().createElement("li",null,"In the next step, click ",p().createElement("code",null,"Create Key"),". Choose key type ",p().createElement("code",null,"JSON")," and click",p().createElement("code",null,"Create"),". A JSON key file will be created and downloaded to your computer"),p().createElement("li",null,"Note your ",p().createElement("code",null,"service account email")," ex) *",p().createElement("em",null,"@"),"*.iam.gserviceaccount.com"),p().createElement("li",null,"Open the","v3"===o.version?p().createElement(p().Fragment,null,p().createElement("a",{href:"https://console.cloud.google.com/apis/library/analytics.googleapis.com"},"Google Analytics API(UA)")):p().createElement(p().Fragment,null,p().createElement("a",{href:"https://console.cloud.google.com/apis/library/analyticsadmin.googleapis.com"},"Google Analytics Admin API(GA4)")),"in API Library and enable access for your account"),p().createElement("li",null,"Open the","v3"===o.version?p().createElement(p().Fragment,null,p().createElement("a",{href:"https://console.cloud.google.com/marketplace/product/google/analyticsreporting.googleapis.com"},"Google Analytics Reporting API(UA)")):p().createElement(p().Fragment,null,p().createElement("a",{href:"https://console.cloud.google.com/apis/library/analyticsdata.googleapis.com"},"Google Analytics Data API(GA4)")),"in API Library and enable access for your Analytics Data"),p().createElement("li",null,p().createElement("a",{href:"https://console.cloud.google.com/apis/dashboard"},"Check your api setting"))),p().createElement("h3",{id:"google-analytics-setting"},"Google Analytics Setting"),p().createElement("ol",{style:{listStylePosition:"inside"}},p().createElement("li",null,"Open the ",p().createElement("a",{href:"https://analytics.google.com/"},"Google Analytics")),p().createElement("li",null,"Select Your Analytics Account And Open Admin Page"),p().createElement("li",null,"Click ",p().createElement("strong",null,"Account User Management")," on the ",p().createElement("strong",null,"Account Tab")),p().createElement("li",null,"Click plus Button then Add users"),p().createElement("li",null,"Enter ",p().createElement("code",null,"service account email")," at ",p().createElement("strong",null,"Generate a JWT file")," 8th step and Permissions add ",p().createElement("code",null,"Read & Analyze")))))}constructor(e){super(e),nt(this,"onResetProfileId",(()=>{const{options:e}=this.props;this.props.onOptionsChange(ot(rt({},e),{secureJsonData:rt({},e.secureJsonData),secureJsonFields:rt({},e.secureJsonFields)}))})),this.props.options.jsonData.version||(this.props.options.jsonData.version="v4")}}var lt=s(531);function st(e,t,n,r,o,i,a){try{var l=e[i](a),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function ct(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){st(i,r,o,a,l,"next",e)}function l(e){st(i,r,o,a,l,"throw",e)}a(void 0)}))}}function ut(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class mt extends lt.DataSourceWithBackend{applyTemplateVariables(e,t){var n;const r=(0,lt.getTemplateSrv)();let o=e.dimensionFilter;return null==o||null===(n=o.orGroup)||void 0===n||n.expressions.map((e=>{var n,o;return(null===(n=e.filter)||void 0===n?void 0:n.stringFilter)&&(e.filter.stringFilter.value=r.replace(e.filter.stringFilter.value,t)),(null===(o=e.filter)||void 0===o?void 0:o.inListFilter)&&(e.filter.inListFilter.values=e.filter.inListFilter.values.map((e=>e=r.replace(e,t)))),e})),pt(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ut(e,t,n[t])}))}return e}({},e),{dimensionFilter:o})}getAccountSummaries(){var e=this;return ct((function*(){let t=(yield e.getResource("account-summaries")).accountSummaries,n=[];for(const e of t){let t={label:e.DisplayName,value:e.Account},r=[];for(const t of e.PropertySummaries){let e={label:t.DisplayName,value:t.Property};r.push(e);let n=[];if(t.ProfileSummaries){for(const e of t.ProfileSummaries){let t={label:e.DisplayName,value:e.Profile};n.push(t)}e.children=n,e.items=n}}t.children=r,t.items=r,n.push(t)}return n}))()}getTimezone(e,t,n){var r=this;return ct((function*(){return r.getResource("profile/timezone",{accountId:e,webPropertyId:t,profileId:n}).then((({timezone:e})=>e))}))()}getServiceLevel(e,t){var n=this;return ct((function*(){return n.getResource("property/service-level",{accountId:e,webPropertyId:t}).then((({serviceLevel:e})=>e))}))()}getMetrics(e,t){var n=this;return ct((function*(){return n.getResource("metrics",{webPropertyId:t}).then((({metrics:t})=>t.reduce(((t,n)=>((n.id.toLowerCase().indexOf(e)>-1||n.attributes.uiName.toLowerCase().indexOf(e)>-1)&&t.push({label:n.attributes.uiName,value:n.id,description:n.attributes.description}),t)),[])))}))()}getDimensions(e,t,n){var r=this;return ct((function*(){return r.getResource("dimensions",{webPropertyId:n}).then((({dimensions:n})=>n.reduce(((n,r)=>((r.id.toLowerCase().indexOf(e)>-1||r.attributes.uiName.toLowerCase().indexOf(e)>-1)&&!(r.id.toLowerCase().indexOf(t)>-1||r.attributes.uiName.toLowerCase().indexOf(t)>-1)&&n.push({label:r.attributes.uiName,value:r.id,description:r.attributes.description}),n)),[])))}))()}getRealtimeMetrics(e,t){var n=this;return ct((function*(){return n.getResource("realtime-metrics",{webPropertyId:t}).then((({metrics:t})=>t.reduce(((t,n)=>((n.id.toLowerCase().indexOf(e)>-1||n.attributes.uiName.toLowerCase().indexOf(e)>-1)&&t.push({label:n.attributes.uiName,value:n.id,description:n.attributes.description}),t)),[])))}))()}getRealtimeDimensions(e,t,n){var r=this;return ct((function*(){return r.getResource("realtime-dimensions",{webPropertyId:n}).then((({dimensions:n})=>n.reduce(((n,r)=>((r.id.toLowerCase().indexOf(e)>-1||r.attributes.uiName.toLowerCase().indexOf(e)>-1)&&!(r.id.toLowerCase().indexOf(t)>-1||r.attributes.uiName.toLowerCase().indexOf(t)>-1)&&n.push({label:r.attributes.uiName,value:r.id,description:r.attributes.description}),n)),[])))}))()}getTimeDimensions(){var e=this;return ct((function*(){return e.getDimensions("date",null,"")}))()}getDimensionsExcludeTimeDimensions(e,t){var n=this;return ct((function*(){return yield n.getDimensions(e,"date",t)}))()}getGaVersion(){return this.version}constructor(e){super(e),ut(this,"version",void 0),this.version=e.jsonData.version}}const ft=new a.DataSourcePlugin(mt).setConfigEditor(at).setQueryEditor(N)})(),c})()));
//# sourceMappingURL=module.js.map